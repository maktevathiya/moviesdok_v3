{% load static %}
<!DOCTYPE html>
<html lang="en" class='bg-[#2d2d2d]'>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}home{% endblock %}</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:ital,wght@0,100..900;1,100..900&display=swap" rel="stylesheet">
    <link href="{% static 'css/dist/styles.css' %}?v={% now "U" %}" rel="stylesheet">
    <link href="{% static 'css/dist/cs.css' %}" rel="stylesheet">
    <script src="https://unpkg.com/htmx.org@1.7.0"></script>    
    
</head>
<body class="bg-[#2d2d2d] font-roboto">
    <!-- Header -->
    <header  class="sticky top-0 z-50 bg-black w-full h-11 md:h-[52px] flex justify-center items-center">
        {% include "partials/header.html" %}
    </header>

    <!-- Main Content Area -->
    <main>
      <div id="content" class="max-w-screen-2xl min-w-56 min-h-screen mx-auto" >
        {% include partial_template %}
      </div>


      <div id="info-modal" tabindex="-1"  aria-hidden="true" class="hidden bg-black/60 overflow-y-auto overflow-x-hidden fixed top-0 right-0 left-0 z-50 justify-center items-center w-full md:inset-0 h-full">
        <div class="relative p-4 w-full max-w-2xl max-h-full">
          <!-- Modal content -->
          <div class="relative bg-[#2d2d2d] rounded-xl shadow-lg p-4 md:p-5">
            <!--header-->
            <div class="pb-4 md:pb-5 flex justify-between">
              <div class="">
                <h2 id="info-modal-title" class="font-bold text-white text-lg pb-1  w-full"></h2>
                <!-- Genre and Release Date -->
                <h3 id="info-modal-genre" class="font-bold text-sm text-[#cecccc]"></h3>
                <h2 id="info-modal-release-date" class="text-[#cccccc] text-xs font-bold"></h2>
              </div>
              <div>
                <button type="button" data-modal-hide="info-modal" class="font-bold text-[#0A84FF] items-start">
                  Close
                  <span class="sr-only">Close</span>
                </button>
              </div>
            </div>
            <!--body-->
            <div class="pt-4 md:pt-5 max-h-[70vh] overflow-y-auto no-scrollbar flex flex-col">
              <!-- Description Section -->
              <p id="info-modal-description" class="text-white text-sm flex-grow"></p>
            </div>
            
          </div>
        </div>               
      </div>
      
      <div id="trailer-modal"  tabindex="-1" aria-labelledby="trailer-modal" class=" bg-black overflow-y-auto overflow-x-hidden fixed top-0 right-0 transition-transform translate-x-full z-50  w-full h-full">
          <!-- Modal content -->
            <!-- header -->
            <button type="button" data-drawer-hide="trailer-modal" class="absolute group top-0 right-0 m-4 font-bold rounded-full bg-[#333333] hover:bg-[#2e2e2e] p-2">
              <svg class="fill-[#cecccc] group-hover:fill-white" xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960" width="24px" >
                <path d="m256-200-56-56 224-224-224-224 56-56 224 224 224-224 56 56-224 224 224 224-56 56-224-224-224 224Z"/></svg>
              <span class="sr-only">Close</span>
            </button>
        
            <!-- body -->
            <div class="flex items-center justify-center w-full h-full md:p-14">
              <iframe 
                class="w-full aspect-[16/9] md:aspect-none md:w-full md:h-full md:rounded-lg" 
                src="" 
                frameborder="0" 
                allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" 
                allowfullscreen>
              </iframe>
            </div>
      </div>
    </main>

    <!-- Footer -->
    <footer>
        {% include "partials/footer.html" %}
    </footer>

    
    <script src="{% static 'js/flow.js' %}"></script>
    <script src="{% static 'js/js.js' %}"></script>
    <script>
      document.addEventListener("DOMContentLoaded", () => {
        const totalSlides = {{ trending_all|length }}; // Total slides from the Django context
        const visibleDots = 8; // Number of dots visible at a time
        const indicatorContainer = document.getElementById("dynamic-indicator-container");
        let currentSlide = 0;
        const slides = document.querySelectorAll("[data-carousel-item]");
    
        // Function to check if the description overflows
        const checkOverflow = (slideIndex) => {
            const descriptionContainer = document.getElementById(`description-container-${slideIndex}`);
            const moreButton = document.getElementById(`more-button-${slideIndex}`);
            
            if (descriptionContainer.scrollHeight > descriptionContainer.offsetHeight) {
                moreButton.classList.remove("hidden");
                descriptionContainer.classList.add("hide-last-word");

            } else {
                moreButton.classList.add("hidden");
                descriptionContainer.classList.remove("hide-last-word");
              }
        };
    
        // Function to update indicators dynamically
        function updateIndicators() {
            indicatorContainer.innerHTML = ""; // Clear existing indicators
    
            // Calculate the start and end of the visible range
            const start = Math.max(0, Math.min(currentSlide - Math.floor(visibleDots / 2), totalSlides - visibleDots));
            const end = Math.min(totalSlides, start + visibleDots);
    
            // Create indicator dots based on current slide position
            for (let i = start; i < end; i++) {
                const dot = document.createElement("button");
                dot.type = "button";
                dot.className = `rounded-full transition-all duration-300 ${i === currentSlide ? "w-2 h-2 bg-white" : "w-1 h-1 bg-white/30"}`;
                dot.setAttribute("aria-label", `Slide ${i + 1}`);
                dot.addEventListener("click", () => goToSlide(i)); // Go to the clicked slide
                indicatorContainer.appendChild(dot);
            }
        }
    
        // Function to go to a specific slide
        function goToSlide(slideIndex) {
            currentSlide = slideIndex;
            slides.forEach((slide, index) => slide.classList.toggle("hidden", index !== currentSlide));
            updateIndicators(); // Ensure indicator updates with every navigation
            checkOverflow(currentSlide); // Check overflow for the new slide
        }
    
        // Carousel controls: next and prev buttons
        document.querySelector("[data-carousel-next]").addEventListener("click", () => {
            currentSlide = (currentSlide + 1) % totalSlides;
            goToSlide(currentSlide);
        });
    
        document.querySelector("[data-carousel-prev]").addEventListener("click", () => {
            currentSlide = (currentSlide - 1 + totalSlides) % totalSlides;
            goToSlide(currentSlide);
        });
    
        // Initialize the carousel by displaying the first slide
        goToSlide(0);
    
        // Carousel touch event handlers for swiping
        const carousel = document.querySelector("#controls-carousel .relative");
        let startX = 0;
        let endX = 0;
        let isSwipe = false;
    
        carousel.addEventListener("touchstart", (e) => {
            startX = e.touches[0].clientX; // Store starting X coordinate
            isSwipe = false; // Reset swipe flag at the start of touch
        });
    
        carousel.addEventListener("touchmove", (e) => {
            endX = e.touches[0].clientX; // Store current X coordinate
            if (Math.abs(startX - endX) > 10) { // Set a minimal movement threshold for swipe
                isSwipe = true; // Mark it as a swipe if movement is significant
            }
        });
    
        carousel.addEventListener("touchend", () => {
            const threshold = 10; // Define swipe threshold
    
            if (isSwipe) {
                // Detect swipe direction and go to the respective slide
                if (startX - endX > threshold) {
                    goToSlide((currentSlide + 1) % totalSlides); // Swipe left -> Next slide
                } else if (endX - startX > threshold) {
                    goToSlide((currentSlide - 1 + totalSlides) % totalSlides); // Swipe right -> Previous slide
                }
            }
    
            // Reset the swipe state variables after touch end
            startX = 0;
            endX = 0;
            isSwipe = false; // Clear the swipe flag
        });
    
        // Check overflow on window resize
        window.addEventListener('resize', () => {
            checkOverflow(currentSlide);
        });
    });
    
    </script>
<script>
  
window.onload = () => {
  const descriptionContainers = document.querySelectorAll(".description-container");

  if (!descriptionContainers.length) return; // Ensure at least one description exists

  const checkOverflow = (container, button) => {
      if (container.scrollHeight > container.offsetHeight) {
          container.classList.add("hide-last-word");
          button.classList.remove("hidden");
      } else {
          container.classList.remove("hide-last-word");
          button.classList.add("hidden");
      }
  };

  descriptionContainers.forEach(container => {
      const wrapper = container.closest(".description-wrapper"); // Find the closest wrapper
      if (!wrapper) return; // Ensure the container is inside a wrapper

      const moreButton = wrapper.querySelector(".more-button"); // Get the button inside the same wrapper

      if (!moreButton) return; // Ensure button exists inside this wrapper

      checkOverflow(container, moreButton); // Initial check
      window.addEventListener('resize', () => checkOverflow(container, moreButton)); // Recheck on resize
  });
};

</script>

</body>
</html>
